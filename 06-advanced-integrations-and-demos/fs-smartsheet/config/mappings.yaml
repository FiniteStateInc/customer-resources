# FS-Smartsheet Configuration
# Field mappings between Finite State API and Smartsheet columns

finite_state:
  # These can be overridden by environment variables:
  # FINITE_STATE_DOMAIN and FINITE_STATE_AUTH_TOKEN
  domain: "${FINITE_STATE_DOMAIN}"
  auth_token: "${FINITE_STATE_AUTH_TOKEN}"

smartsheet:
  # Override with SMARTSHEET_ACCESS_TOKEN
  access_token: "${SMARTSHEET_ACCESS_TOKEN}"
  workspace_id: "${SMARTSHEET_WORKSPACE_ID}"
  workspace_name: "Finite State"

sync:
  interval_minutes: 60
  batch_size: 100

  sheets:
    projects:
      fs_endpoint: "/projects"
      columns:
        - fs_field: "id"
          ss_column: "Project ID"
          type: "string"
          primary: true
        - fs_field: "name"
          ss_column: "Name"
          type: "string"
        - fs_field: "description"
          ss_column: "Description"
          type: "string"
        - fs_field: "created"
          ss_column: "Created"
          type: "date"
        - fs_field: "type"
          ss_column: "Type"
          type: "string"
        - fs_field: "createdBy"
          ss_column: "Created By"
          type: "string"
        - fs_field: "defaultBranch.latestVersion.findings"
          ss_column: "Findings"
          type: "number"
        - fs_field: "defaultBranch.latestVersion.components"
          ss_column: "Components"
          type: "number"
        - fs_field: "defaultBranch.latestVersion.violations"
          ss_column: "Violations"
          type: "number"
        - fs_field: "defaultBranch.latestVersion.warnings"
          ss_column: "Warnings"
          type: "number"

    findings:
      fs_endpoint: "/findings"
      columns:
        - fs_field: "id"
          ss_column: "Finding ID"
          type: "string"
          primary: true
        - fs_field: "findingId"
          ss_column: "CVE ID"
          type: "string"
        - fs_field: "title"
          ss_column: "Title"
          type: "string"
        - fs_field: "severity"
          ss_column: "Severity"
          type: "picklist"
          options: ["critical", "high", "medium", "low"]
        - fs_field: "status"
          ss_column: "Status"
          type: "picklist"
          writeback: true
          options:
            - "EXPLOITABLE"
            - "RESOLVED"
            - "RESOLVED_WITH_PEDIGREE"
            - "IN_TRIAGE"
            - "FALSE_POSITIVE"
            - "NOT_AFFECTED"
        - fs_field: "response"
          ss_column: "Response"
          type: "picklist"
          writeback: true
          options:
            - "Can Not Fix"
            - "Will Not Fix"
            - "Update"
            - "Rollback"
            - "Workaround Available"
        - fs_field: "justification"
          ss_column: "Justification"
          type: "picklist"
          writeback: true
          options:
            - "Code Not Present"
            - "Code Not Reachable"
            - "Requires Configuration"
            - "Requires Dependency"
            - "Requires Environment"
            - "Protected By Compiler"
            - "Protected At Runtime"
            - "Protected At Perimeter"
            - "Protected By Mitigating Control"
        - fs_field: "reason"
          ss_column: "Reason"
          type: "string"
          writeback: true
        - fs_field: "risk"
          ss_column: "Risk Score"
          type: "number"
        - fs_field: "epssScore"
          ss_column: "EPSS Score"
          type: "number"
        - fs_field: "epssPercentile"
          ss_column: "EPSS Percentile"
          type: "number"
        - fs_field: "inKev"
          ss_column: "In KEV"
          type: "checkbox"
        - fs_field: "component.name"
          ss_column: "Component"
          type: "string"
        - fs_field: "component.version"
          ss_column: "Component Version"
          type: "string"
        - fs_field: "project.name"
          ss_column: "Project"
          type: "string"
        - fs_field: "projectVersion.version"
          ss_column: "Project Version"
          type: "string"
        - fs_field: "detected"
          ss_column: "Detected"
          type: "date"
        - fs_field: "attackVector"
          ss_column: "Attack Vector"
          type: "string"
        - fs_field: "type"
          ss_column: "Finding Type"
          type: "string"

    components:
      fs_endpoint: "/components"
      columns:
        - fs_field: "id"
          ss_column: "Component ID"
          type: "string"
          primary: true
        - fs_field: "name"
          ss_column: "Name"
          type: "string"
        - fs_field: "version"
          ss_column: "Component Version"
          type: "string"
        - fs_field: "type"
          ss_column: "Type"
          type: "string"
        - fs_field: "supplier"
          ss_column: "Supplier"
          type: "string"
        - fs_field: "declaredLicenses"
          ss_column: "Declared Licenses"
          type: "string"
        - fs_field: "concludedLicenses"
          ss_column: "Concluded Licenses"
          type: "string"
        - fs_field: "findings"
          ss_column: "Findings"
          type: "number"
        - fs_field: "violations"
          ss_column: "Violations"
          type: "number"
        - fs_field: "warnings"
          ss_column: "Warnings"
          type: "number"
        - fs_field: "project.name"
          ss_column: "Project"
          type: "string"
        - fs_field: "projectVersion.version"
          ss_column: "Project Version"
          type: "string"
        - fs_field: "source"
          ss_column: "Source"
          type: "string"
          transform: "join"

    cves:
      fs_endpoint: "/cves"
      columns:
        - fs_field: "cveId"
          ss_column: "CVE ID"
          type: "string"
          primary: true
        - fs_field: "severity"
          ss_column: "Severity"
          type: "picklist"
          options: ["CRITICAL", "HIGH", "MEDIUM", "LOW"]
        - fs_field: "risk"
          ss_column: "Risk Score"
          type: "number"
        - fs_field: "epssScore"
          ss_column: "EPSS Score"
          type: "number"
        - fs_field: "epssPercentile"
          ss_column: "EPSS Percentile"
          type: "number"
        - fs_field: "exploitMaturity"
          ss_column: "Exploit Maturity"
          type: "string"
        - fs_field: "inKev"
          ss_column: "In KEV"
          type: "checkbox"
        - fs_field: "affectedProjects"
          ss_column: "Affected Projects"
          type: "string"
          transform: "count"
        - fs_field: "affectedComponents"
          ss_column: "Affected Components"
          type: "string"
          transform: "count"
        - fs_field: "firstDetected"
          ss_column: "First Detected"
          type: "date"
        - fs_field: "lastDetected"
          ss_column: "Last Detected"
          type: "date"
        - fs_field: "cwes"
          ss_column: "CWEs"
          type: "string"
          transform: "join"
