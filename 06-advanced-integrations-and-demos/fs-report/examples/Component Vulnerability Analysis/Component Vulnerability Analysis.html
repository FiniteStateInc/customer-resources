<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Component Vulnerability Analysis - Finite State Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border: 1px solid #dee2e6;
            min-height: 100%;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .logo-container {
            margin-bottom: 20px;
        }
        
        .company-logo {
            max-height: 50px;
            width: auto;
            margin: 0 auto;
            display: block;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #6c757d;
            font-size: 1.1em;
        }
        
        .metadata {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .chart-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
        }
        
        .chart-wrapper {
            position: relative;
            height: 500px;
            margin: 20px 0;
        }
        
        .chart-title {
            color: #2c3e50;
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .chart-description {
            color: #6c757d;
            font-size: 0.95em;
            margin-bottom: 20px;
        }
        
        .narrative-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
        }
        
        .narrative-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .narrative-section h4 {
            color: #495057;
            margin: 20px 0 10px 0;
        }
        
        .narrative-section ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .narrative-section li {
            margin-bottom: 8px;
        }
        
        .table-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            min-width: 600px;
            table-layout: fixed;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 300px;
            min-width: 100px;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
            z-index: 10;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .finite-state-logo {
            color: #007bff;
            font-weight: bold;
        }
        
        .severity-critical { color: #dc3545; font-weight: bold; }
        .severity-high { color: #fd7e14; font-weight: bold; }
        .severity-medium { color: #ffc107; font-weight: bold; }
        .severity-low { color: #28a745; font-weight: bold; }
        
        .kev-marker { color: #dc3545; }
        .exploit-marker { color: #6f42c1; }
        
        .no-data {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }
        
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }
        
        @media print {
            body {
                background-color: white;
            }
            
            .container {
                max-width: none;
            }
            
            .chart-container, .narrative-section, .table-container {
                border: 1px solid #dee2e6;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="https://finitestate.io/hs-fs/hubfs/FS-Logo-Final-01.png?width=256&height=50&name=FS-Logo-Final-01.png" 
                     alt="Finite State Logo" 
                     class="company-logo">
            </div>
            <h1>Component Vulnerability Analysis</h1>
            <div class="subtitle">Finite State Security Report</div>
        </div>
        
        <div class="metadata">
            <strong>Report:</strong> Component Vulnerability Analysis | 
            <strong>Generated:</strong> 2026-02-03 10:15:11 UTC | 
            
            <strong>Period:</strong> 2026-01-01 to 2026-01-31 | 
            
            <strong>Records:</strong> N/A
        </div>
        
        <!-- Charts Section -->
        
            <!-- 1. Pareto Chart - Top Risk Components -->
            
            <div class="chart-container">
                <h2 class="chart-title">ðŸ”¢ Top Risk Components - Pareto Analysis</h2>
                <p class="chart-description">Components sorted by composite risk score with cumulative risk percentage. Shows which components contribute disproportionately to total risk.</p>
                <div class="chart-wrapper">
                    <canvas id="paretoChart"></canvas>
                </div>
            </div>
            

            <!-- 2. Bubble Matrix - Scope vs Severity -->
            
            <div class="chart-container">
                <h2 class="chart-title">ðŸŽ¯ Component Risk vs Project Scope</h2>
                <p class="chart-description">Bubble chart showing risk score vs number of affected projects. Bubble size represents finding count.</p>
                <div class="chart-wrapper">
                    <canvas id="bubbleMatrixChart"></canvas>
                </div>
            </div>
            




        

        <div class="narrative-section">
            <h3>Executive Summary</h3>
            <p>The Component Vulnerability Analysis provides a strategic portfolio-level view of the most problematic components across your entire organization. This report identifies which component versions pose the highest risk and have the broadest impact, enabling portfolio-wide component risk prioritization.</p>
            
            <h4>Key Insights from Visualizations</h4>
            <ul>
                <li><strong>Pareto Analysis</strong>: Shows which components contribute disproportionately to total risk, with each version treated uniquely for precise risk assessment.</li>
                <li><strong>Risk vs. Scope</strong>: Identifies components with both high risk and broad project impact for maximum remediation efficiency.</li>
                <li><strong>Normalized Risk Scoring</strong>: Risk scores are normalized by project count to provide fair comparison across components used in different numbers of projects.</li>
            </ul>
            
            <h4>Strategic Recommendations</h4>
            <ul>
                <li><strong>High-Risk Components</strong>: Focus immediate remediation efforts on components with the highest normalized risk scores.</li>
                <li><strong>High-Impact Components</strong>: Prioritize components affecting multiple projects for maximum portfolio-wide risk reduction.</li>
                <li><strong>KEV and Exploit Flags</strong>: Components with ðŸ”’ (KEV) or ðŸ’¥ (exploit) markers require immediate attention due to federal guidance and active threats.</li>
                <li><strong>Portfolio Management</strong>: Use this report to inform strategic component selection and vendor partnerships.</li>
            </ul>
        </div>



        <!-- Portfolio-Level Component Risk Data -->
        
        <div class="table-container">
            <h2>Portfolio-Level Component Risk Data</h2>
            <table>
                <thead>
                    <tr>
                        <th>Component Name</th>
                        <th>Version</th>
                        <th>Projects Affected</th>
                        <th>Portfolio Composite Risk</th>
                        <th>Normalized Risk Score</th>
                        <th>Findings Count</th>
                        <th>Has KEV</th>
                        <th>Has Exploits</th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <td>org.apache.commons/commons-text</td>
                        <td>1.9</td>
                        <td>8</td>
                        <td class="severity-critical">5380</td>
                        <td class="severity-critical">250</td>
                        <td>47</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>org.apache.logging.log4j/log4j-core</td>
                        <td>2.17.0</td>
                        <td>8</td>
                        <td class="severity-critical">4945</td>
                        <td class="severity-critical">230</td>
                        <td>50</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>org.springframework/spring-core</td>
                        <td>5.3.20</td>
                        <td>8</td>
                        <td class="severity-critical">4040</td>
                        <td class="severity-high">188</td>
                        <td>56</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>com.fasterxml.jackson.core/jackson-databind</td>
                        <td>2.13.4</td>
                        <td>8</td>
                        <td class="severity-critical">3055</td>
                        <td class="severity-high">142</td>
                        <td>51</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>jsonwebtoken</td>
                        <td>9.0.0</td>
                        <td>8</td>
                        <td class="severity-critical">2440</td>
                        <td class="severity-high">113</td>
                        <td>58</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>org.springframework/spring-web</td>
                        <td>5.3.20</td>
                        <td>8</td>
                        <td class="severity-critical">2430</td>
                        <td class="severity-high">113</td>
                        <td>37</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>openssl</td>
                        <td>1.1.1q</td>
                        <td>8</td>
                        <td class="severity-critical">2340</td>
                        <td class="severity-high">109</td>
                        <td>45</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>org.yaml/snakeyaml</td>
                        <td>1.30</td>
                        <td>8</td>
                        <td class="severity-critical">2110</td>
                        <td class="severity-medium">98</td>
                        <td>39</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>lodash</td>
                        <td>4.17.21</td>
                        <td>8</td>
                        <td class="severity-critical">1930</td>
                        <td class="severity-medium">90</td>
                        <td>40</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>linux-kernel</td>
                        <td>5.15.0</td>
                        <td>8</td>
                        <td class="severity-critical">1835</td>
                        <td class="severity-medium">85</td>
                        <td>30</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>nginx</td>
                        <td>1.23.2</td>
                        <td>8</td>
                        <td class="severity-critical">690</td>
                        <td class="severity-low">32</td>
                        <td>24</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>sequelize</td>
                        <td>6.28.0</td>
                        <td>8</td>
                        <td class="severity-critical">580</td>
                        <td class="severity-low">27</td>
                        <td>13</td>
                        <td>ðŸ”’</td>
                        <td>ðŸ’¥</td>
                    </tr>
                    
                    <tr>
                        <td>django</td>
                        <td>4.1.0</td>
                        <td>8</td>
                        <td class="severity-critical">440</td>
                        <td class="">20</td>
                        <td>28</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>libcurl</td>
                        <td>7.86.0</td>
                        <td>8</td>
                        <td class="severity-critical">440</td>
                        <td class="">20</td>
                        <td>28</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>org.springframework.boot/spring-boot</td>
                        <td>2.7.0</td>
                        <td>6</td>
                        <td class="severity-critical">420</td>
                        <td class="">20</td>
                        <td>30</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>org.apache.tomcat.embed/tomcat-embed-core</td>
                        <td>9.0.65</td>
                        <td>8</td>
                        <td class="severity-critical">400</td>
                        <td class="">19</td>
                        <td>24</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>pillow</td>
                        <td>9.3.0</td>
                        <td>8</td>
                        <td class="severity-critical">400</td>
                        <td class="">19</td>
                        <td>24</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>org.apache.logging.log4j/log4j-api</td>
                        <td>2.17.0</td>
                        <td>7</td>
                        <td class="severity-critical">400</td>
                        <td class="">19</td>
                        <td>26</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>moment</td>
                        <td>2.29.4</td>
                        <td>8</td>
                        <td class="severity-critical">400</td>
                        <td class="">19</td>
                        <td>24</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>busybox</td>
                        <td>1.35.0</td>
                        <td>8</td>
                        <td class="severity-critical">390</td>
                        <td class="">18</td>
                        <td>23</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>express</td>
                        <td>4.18.2</td>
                        <td>8</td>
                        <td class="severity-critical">390</td>
                        <td class="">18</td>
                        <td>23</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>sqlite</td>
                        <td>3.40.0</td>
                        <td>8</td>
                        <td class="severity-critical">320</td>
                        <td class="">15</td>
                        <td>16</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>requests</td>
                        <td>2.28.1</td>
                        <td>7</td>
                        <td class="severity-critical">310</td>
                        <td class="">14</td>
                        <td>17</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>org.bouncycastle/bcprov-jdk15on</td>
                        <td>1.70</td>
                        <td>8</td>
                        <td class="severity-critical">290</td>
                        <td class="">13</td>
                        <td>13</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>postgresql</td>
                        <td>15.0</td>
                        <td>7</td>
                        <td class="severity-critical">290</td>
                        <td class="">13</td>
                        <td>15</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>redis</td>
                        <td>7.0.5</td>
                        <td>7</td>
                        <td class="severity-critical">280</td>
                        <td class="">13</td>
                        <td>14</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>glibc</td>
                        <td>2.35</td>
                        <td>7</td>
                        <td class="severity-critical">260</td>
                        <td class="">12</td>
                        <td>12</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>axios</td>
                        <td>1.2.0</td>
                        <td>7</td>
                        <td class="severity-critical">250</td>
                        <td class="">12</td>
                        <td>11</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>flask</td>
                        <td>2.2.2</td>
                        <td>5</td>
                        <td class="severity-critical">210</td>
                        <td class="">10</td>
                        <td>11</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                    <tr>
                        <td>zlib</td>
                        <td>1.2.13</td>
                        <td>4</td>
                        <td class="severity-high">140</td>
                        <td class="">7</td>
                        <td>6</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    
                </tbody>
            </table>
        </div>
        

        <div class="footer">
            <p>Generated by <span class="finite-state-logo">Finite State</span> | 2026-02-03 10:15:11 UTC</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Comprehensive color palette for broad analysis
            const colors = {
                primary: '#2E86AB',      // Ocean Blue
                secondary: '#A23B72',    // Deep Rose
                tertiary: '#F18F01',     // Vibrant Orange
                quaternary: '#C73E1D',   // Rich Red
                quinary: '#8B5A2B',      // Saddle Brown
                senary: '#228B22',       // Forest Green
                septenary: '#9370DB',    // Medium Purple
                octonary: '#FF6347',     // Tomato Red
                nonary: '#20B2AA',       // Light Sea Green
                denary: '#FFD700',       // Gold
                eleventh: '#DC143C',     // Crimson
                twelfth: '#32CD32',      // Lime Green
                thirteenth: '#FF69B4',   // Hot Pink
                fourteenth: '#4169E1',   // Royal Blue
                fifteenth: '#FF4500'     // Orange Red
            };

            // Helper function to safely parse JSON
            function safeParseJSON(jsonString, fallback = {}) {
                try {
                    return JSON.parse(jsonString);
                } catch (e) {
                    console.warn('Failed to parse JSON:', e);
                    return fallback;
                }
            }

            // Helper function to create chart with error handling
            function createChart(canvasId, chartData, chartType = 'bar') {
                const canvas = document.getElementById(canvasId);
                if (!canvas) {
                    console.warn(`Canvas with id '${canvasId}' not found`);
                    return;
                }

                if (!chartData || !chartData.labels || !chartData.datasets) {
                    console.warn(`Invalid chart data for ${canvasId}`);
                    return;
                }

                const ctx = canvas.getContext('2d');
                return new Chart(ctx, {
                    type: chartType,
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            title: {
                                display: false
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Components'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Risk Score'
                                }
                            }
                        }
                    }
                });
            }



            // Create Pareto Chart
            
            const paretoData = safeParseJSON('{"labels": ["org.apache.commons/commons-text (1.9)", "org.apache.logging.log4j/log4j-core (2.17.0)", "org.springframework/spring-core (5.3.20)", "com.fasterxml.jackson.core/jackson-databind (2.13.4)", "jsonwebtoken (9.0.0)", "org.springframework/spring-web (5.3.20)", "openssl (1.1.1q)", "org.yaml/snakeyaml (1.30)", "lodash (4.17.21)", "linux-kernel (5.15.0)", "nginx (1.23.2)", "sequelize (6.28.0)", "django (4.1.0)", "libcurl (7.86.0)", "org.springframework.boot/spring-boot (2.7.0)", "org.apache.logging.log4j/log4j-api (2.17.0)", "moment (2.29.4)", "org.apache.tomcat.embed/tomcat-embed-core (9.0.65)", "pillow (9.3.0)", "busybox (1.35.0)"], "datasets": [{"label": "Composite Risk Score", "data": [5380, 4945, 4040, 3055, 2440, 2430, 2340, 2110, 1930, 1835, 690, 580, 440, 440, 420, 400, 400, 400, 400, 390], "backgroundColor": ["hsl(0, 70%, 50%)", "hsl(3.8552684483925646, 70%, 50%)", "hsl(13.098076547772493, 70%, 50%)", "hsl(25.877046695023694, 70%, 50%)", "hsl(36.15552785848682, 70%, 50%)", "hsl(36.34331675984296, 70%, 50%)", "hsl(38.06905112081634, 70%, 50%)", "hsl(42.800054598132505, 70%, 50%)", "hsl(46.87739557709257, 70%, 50%)", "hsl(49.18546618329731, 70%, 50%)", "hsl(93.91096157983172, 70%, 50%)", "hsl(101.8519911084156, 70%, 50%)", "hsl(114.4841003099787, 70%, 50%)", "hsl(114.4841003099787, 70%, 50%)", "hsl(116.61129934997223, 70%, 50%)", "hsl(118.84230441232857, 70%, 50%)", "hsl(118.84230441232857, 70%, 50%)", "hsl(118.84230441232857, 70%, 50%)", "hsl(118.84230441232857, 70%, 50%)", "hsl(120, 70%, 50%)"], "borderColor": ["#000000", "#000000", "#000000", "#000000", "#000000", "#000000", "#000000", "#000000", "#000000", "#000000", "#000000", "#000000", "hsl(114.4841003099787, 70%, 50%)", "hsl(114.4841003099787, 70%, 50%)", "hsl(116.61129934997223, 70%, 50%)", "hsl(118.84230441232857, 70%, 50%)", "hsl(118.84230441232857, 70%, 50%)", "hsl(118.84230441232857, 70%, 50%)", "hsl(118.84230441232857, 70%, 50%)", "hsl(120, 70%, 50%)"], "borderWidth": 3, "yAxisID": "y"}, {"label": "Cumulative Percentage", "data": [15.342934550121203, 29.4453158420077, 40.966775987451875, 49.67916726080137, 56.63767289319834, 63.56766005988877, 70.2409810352203, 76.25837729930129, 81.76244118066448, 86.9955796378155, 88.96335377156709, 90.61742478254669, 91.87223727363468, 93.12704976472266, 94.32482532439754, 95.46556395265935, 96.60630258092114, 97.74704120918295, 98.88777983744474, 100.0], "type": "line", "borderColor": "#FF6B35", "backgroundColor": "rgba(255, 107, 53, 0.2)", "borderWidth": 3, "pointBackgroundColor": "white", "pointBorderColor": "#FF6B35", "pointRadius": 6, "pointBorderWidth": 2, "yAxisID": "y1"}], "markers": {"kev": [true, true, true, true, true, true, true, true, true, true, true, true, false, false, false, false, false, false, false, false], "exploit": [true, true, true, true, true, true, true, true, true, true, true, true, false, false, false, false, false, false, false, false]}}');
            if (paretoData.labels && paretoData.labels.length > 0) {
                const paretoCtx = document.getElementById('paretoChart');
                if (paretoCtx) {
                    new Chart(paretoCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: paretoData.labels,
                            datasets: paretoData.datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                title: { display: false },
                                legend: { 
                                    display: true, 
                                    position: 'top',
                                    labels: {
                                        generateLabels: function(chart) {
                                            return [
                                                {
                                                    text: 'ðŸ”’ðŸ’¥ KEV + Exploit',
                                                    fillStyle: '#ffffff',
                                                    strokeStyle: '#000000',
                                                    lineWidth: 4,
                                                    hidden: false,
                                                    index: 0
                                                },
                                                {
                                                    text: 'ðŸ’¥ Has Exploit',
                                                    fillStyle: '#ffffff',
                                                    strokeStyle: '#FF0000',
                                                    lineWidth: 3,
                                                    hidden: false,
                                                    index: 1
                                                },
                                                {
                                                    text: 'Standard Risk',
                                                    fillStyle: '#FFA500',
                                                    strokeStyle: '#FFA500',
                                                    lineWidth: 1,
                                                    hidden: false,
                                                    index: 2
                                                }
                                            ];
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        afterLabel: function(context) {
                                            const dataIndex = context.dataIndex;
                                            const kevMarker = paretoData.markers && paretoData.markers.kev && paretoData.markers.kev[dataIndex] ? ' ðŸ”’' : '';
                                            const exploitMarker = paretoData.markers && paretoData.markers.exploit && paretoData.markers.exploit[dataIndex] ? ' ðŸ’¥' : '';
                                            return kevMarker + exploitMarker;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    title: { display: true, text: 'Components (sorted by risk)' }
                                },
                                y: {
                                    type: 'logarithmic',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'Composite Risk Score (log scale)' },
                                    min: 1
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'Cumulative Percentage (%)' },
                                    grid: { drawOnChartArea: false },
                                    min: 0,
                                    max: 100
                                }
                            },
                            elements: {
                                bar: {
                                    z: 1
                                },
                                line: {
                                    z: 2
                                },
                                point: {
                                    z: 3
                                }
                            }
                        }
                    });
                }
            }
            

            // Create Bubble Matrix Chart
            
            const bubbleData = safeParseJSON('{"data": [{"x": 5380, "y": 8, "r": 41.53846153846153, "component": "org.apache.commons/commons-text (1.9)", "findingCount": 47, "hasExploit": true, "inKev": true}, {"x": 4945, "y": 8, "r": 43.84615384615385, "component": "org.apache.logging.log4j/log4j-core (2.17.0)", "findingCount": 50, "hasExploit": true, "inKev": true}, {"x": 4040, "y": 8, "r": 48.46153846153846, "component": "org.springframework/spring-core (5.3.20)", "findingCount": 56, "hasExploit": true, "inKev": true}, {"x": 3055, "y": 8, "r": 44.61538461538461, "component": "com.fasterxml.jackson.core/jackson-databind (2.13.4)", "findingCount": 51, "hasExploit": true, "inKev": true}, {"x": 2440, "y": 8, "r": 50.0, "component": "jsonwebtoken (9.0.0)", "findingCount": 58, "hasExploit": true, "inKev": true}, {"x": 2430, "y": 8, "r": 33.84615384615385, "component": "org.springframework/spring-web (5.3.20)", "findingCount": 37, "hasExploit": true, "inKev": true}, {"x": 2340, "y": 8, "r": 40.0, "component": "openssl (1.1.1q)", "findingCount": 45, "hasExploit": true, "inKev": true}, {"x": 2110, "y": 8, "r": 35.38461538461539, "component": "org.yaml/snakeyaml (1.30)", "findingCount": 39, "hasExploit": true, "inKev": true}, {"x": 1930, "y": 8, "r": 36.15384615384615, "component": "lodash (4.17.21)", "findingCount": 40, "hasExploit": true, "inKev": true}, {"x": 1835, "y": 8, "r": 28.461538461538463, "component": "linux-kernel (5.15.0)", "findingCount": 30, "hasExploit": true, "inKev": true}, {"x": 690, "y": 8, "r": 23.846153846153847, "component": "nginx (1.23.2)", "findingCount": 24, "hasExploit": true, "inKev": true}, {"x": 580, "y": 8, "r": 15.384615384615383, "component": "sequelize (6.28.0)", "findingCount": 13, "hasExploit": true, "inKev": true}, {"x": 440, "y": 8, "r": 26.923076923076923, "component": "django (4.1.0)", "findingCount": 28, "hasExploit": false, "inKev": false}, {"x": 440, "y": 8, "r": 26.923076923076923, "component": "libcurl (7.86.0)", "findingCount": 28, "hasExploit": false, "inKev": false}, {"x": 420, "y": 6, "r": 28.461538461538463, "component": "org.springframework.boot/spring-boot (2.7.0)", "findingCount": 30, "hasExploit": false, "inKev": false}, {"x": 400, "y": 8, "r": 23.846153846153847, "component": "org.apache.tomcat.embed/tomcat-embed-core (9.0.65)", "findingCount": 24, "hasExploit": false, "inKev": false}, {"x": 400, "y": 8, "r": 23.846153846153847, "component": "pillow (9.3.0)", "findingCount": 24, "hasExploit": false, "inKev": false}, {"x": 400, "y": 7, "r": 25.384615384615387, "component": "org.apache.logging.log4j/log4j-api (2.17.0)", "findingCount": 26, "hasExploit": false, "inKev": false}, {"x": 400, "y": 8, "r": 23.846153846153847, "component": "moment (2.29.4)", "findingCount": 24, "hasExploit": false, "inKev": false}, {"x": 390, "y": 8, "r": 23.076923076923077, "component": "busybox (1.35.0)", "findingCount": 23, "hasExploit": false, "inKev": false}, {"x": 390, "y": 8, "r": 23.076923076923077, "component": "express (4.18.2)", "findingCount": 23, "hasExploit": false, "inKev": false}, {"x": 320, "y": 8, "r": 17.692307692307693, "component": "sqlite (3.40.0)", "findingCount": 16, "hasExploit": false, "inKev": false}, {"x": 310, "y": 7, "r": 18.46153846153846, "component": "requests (2.28.1)", "findingCount": 17, "hasExploit": false, "inKev": false}, {"x": 290, "y": 8, "r": 15.384615384615383, "component": "org.bouncycastle/bcprov-jdk15on (1.70)", "findingCount": 13, "hasExploit": false, "inKev": false}, {"x": 290, "y": 7, "r": 16.923076923076923, "component": "postgresql (15.0)", "findingCount": 15, "hasExploit": false, "inKev": false}, {"x": 280, "y": 7, "r": 16.153846153846153, "component": "redis (7.0.5)", "findingCount": 14, "hasExploit": false, "inKev": false}, {"x": 260, "y": 7, "r": 14.615384615384617, "component": "glibc (2.35)", "findingCount": 12, "hasExploit": false, "inKev": false}, {"x": 250, "y": 7, "r": 13.846153846153847, "component": "axios (1.2.0)", "findingCount": 11, "hasExploit": false, "inKev": false}, {"x": 210, "y": 5, "r": 13.846153846153847, "component": "flask (2.2.2)", "findingCount": 11, "hasExploit": false, "inKev": false}, {"x": 140, "y": 4, "r": 10.0, "component": "zlib (1.2.13)", "findingCount": 6, "hasExploit": false, "inKev": false}]}');
            if (bubbleData.data && bubbleData.data.length > 0) {
                const bubbleCtx = document.getElementById('bubbleMatrixChart');
                if (bubbleCtx) {
                    // Find max risk score for relative coloring
                    const maxRiskScore = Math.max(...bubbleData.data.map(p => p.x));
                    const minRiskScore = Math.min(...bubbleData.data.map(p => p.x));
                    
                    // Create datasets with visual indicators and relative coloring
                    const datasets = [];
                    const allPoints = bubbleData.data;
                    
                    // Group by pattern type
                    const exploitOnlyPoints = allPoints.filter(p => !p.inKev && p.hasExploit);
                    const bothPoints = allPoints.filter(p => p.inKev && p.hasExploit);
                    const normalPoints = allPoints.filter(p => !p.inKev && !p.hasExploit);
                    
                    // Helper function to get color based on risk ratio using log scale
                    function getRiskColor(riskScore, maxRisk, minRisk) {
                        // Use logarithmic scale for color mapping to match the axis
                        const logMin = Math.log(Math.max(1, minRisk));
                        const logMax = Math.log(maxRisk);
                        const logValue = Math.log(Math.max(1, riskScore));
                        const ratio = Math.max(0, Math.min(1, (logValue - logMin) / (logMax - logMin)));
                        return `hsl(${120 - ratio * 120}, 70%, 50%)`; // Green to red
                    }
                    
                    // Add datasets with visual indicators
                    if (exploitOnlyPoints.length > 0) {
                        datasets.push({
                            label: 'ðŸ’¥ Has Exploit',
                            data: exploitOnlyPoints,
                            backgroundColor: exploitOnlyPoints.map(p => getRiskColor(p.x, maxRiskScore, minRiskScore)),
                            borderColor: '#FF0000',
                            borderWidth: 3,
                            fill: true
                        });
                    }
                    
                    if (bothPoints.length > 0) {
                        datasets.push({
                            label: 'ðŸ”’ðŸ’¥ KEV + Exploit',
                            data: bothPoints,
                            backgroundColor: bothPoints.map(p => getRiskColor(p.x, maxRiskScore, minRiskScore)),
                            borderColor: '#000000',
                            borderWidth: 4,
                            fill: true
                        });
                    }
                    
                    if (normalPoints.length > 0) {
                        datasets.push({
                            label: 'Standard Risk',
                            data: normalPoints,
                            backgroundColor: normalPoints.map(p => getRiskColor(p.x, maxRiskScore, minRiskScore)),
                            borderColor: normalPoints.map(p => getRiskColor(p.x, maxRiskScore, minRiskScore)),
                            borderWidth: 1,
                            fill: true
                        });
                    }
                    
                    // Find top N by risk score for labeling
                    const N = 10;
                    const topPoints = [...allPoints].sort((a, b) => b.x - a.x).slice(0, N);
                    
                    // Compute y max for headroom
                    const maxY = Math.max(...allPoints.map(p => p.y));
                    const yMax = Math.ceil(maxY + 1);
                    
                    new Chart(bubbleCtx.getContext('2d'), {
                        type: 'bubble',
                        data: { datasets: datasets },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: false },
                                legend: { 
                                    display: true, 
                                    position: 'top',
                                    labels: {
                                        generateLabels: function(chart) {
                                            const datasets = chart.data.datasets;
                                            return datasets.map((dataset, i) => {
                                                const isExploit = dataset.label.includes('ðŸ’¥') && !dataset.label.includes('ðŸ”’');
                                                const isBoth = dataset.label.includes('ðŸ”’ðŸ’¥');
                                                const isStandard = dataset.label === 'Standard Risk';
                                                
                                                return {
                                                    text: dataset.label,
                                                    fillStyle: isStandard ? '#FFA500' : 
                                                             (isExploit || isBoth) ? '#ffffff' : 
                                                             (dataset.backgroundColor[0] || dataset.backgroundColor),
                                                    strokeStyle: isBoth ? '#000000' : 
                                                                isExploit ? '#FF0000' : 
                                                                (dataset.borderColor[0] || dataset.borderColor),
                                                    lineWidth: isBoth ? 4 : 
                                                              isExploit ? 3 : 
                                                              (dataset.borderWidth || 1),
                                                    hidden: !chart.isDatasetVisible(i),
                                                    index: i
                                                };
                                            });
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const point = context.raw;
                                            let label = [
                                                `Component: ${point.component}`,
                                                `Risk Score: ${point.x.toLocaleString()}`,
                                                `Projects Affected: ${point.y}`,
                                                `Finding Count: ${point.findingCount}`
                                            ];
                                            if (point.hasExploit && point.inKev) label.push('ðŸ”’ðŸ’¥ KEV + Exploit');
                                            else if (point.hasExploit) label.push('ðŸ’¥ Has Known Exploit');
                                            else if (point.inKev) label.push('ðŸ”’ In KEV');
                                            return label.filter(Boolean);
                                        }
                                    }
                                },
                                datalabels: {
                                    display: function(context) {
                                        const point = context.raw;
                                        return topPoints.includes(point);
                                    },
                                    align: 'top',
                                    anchor: 'end',
                                    font: { weight: 'bold', size: 10 },
                                    color: '#222',
                                    backgroundColor: 'rgba(255,255,255,0.7)',
                                    borderRadius: 4,
                                    padding: 2,
                                    formatter: function(value, context) {
                                        let name = value.component || '';
                                        if (name.length > 18) name = name.slice(0, 15) + '...';
                                        return name;
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    type: 'logarithmic',
                                    title: { display: true, text: 'Composite Risk Score (log scale)' },
                                    min: Math.max(1, minRiskScore * 0.1),
                                    max: maxRiskScore * 1.1
                                },
                                y: {
                                    title: { display: true, text: 'Number of Projects Affected' },
                                    ticks: {
                                        stepSize: 1,
                                        precision: 0
                                    },
                                    min: 0,
                                    max: yMax
                                }
                            }
                        },
                        plugins: [ChartDataLabels]
                    });
                }
            }
            


        });
    </script>
</body>
</html> 